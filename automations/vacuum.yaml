- id: vacuum_regular_cleaning
  alias: Vacuum Regular Cleaning
  description: Regular vacuum cleaning every two days
  trigger:
    - platform: time_pattern
      hours: '/2'
      minutes: 0
      seconds: 0
  condition:
      # Robot is docked
    - condition: state
      entity_id: vacuum.roborock
      state: 'docked'
      # It's working day
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
      # Only on activity time
    - condition: state
      entity_id: binary_sensor.activity_time
      state: 'on'
  action:
    - service: script.vacuum_regular_cleaning

- id: vacuum_finish_cleaning
  alias: Vacuum Stop Cleaning
  description: Send vacuum home when somebody comes home
  trigger:
    platform: state
    entity_id: group.family
    from: not_home
    to: home
  action:
    - service: vacuum.return_to_base
      entity_id: vacuum.roborock

- id: vacuum_finish_notification
  alias: Vacuum Finish Notification
  description: Notify when vacuum finished cleaning
  trigger:
    platform: state
    entity_id: vacuum.roborock
    from: 'cleaning'
    to: 'returning'
  action:
    - service: script.announcement
      data:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        messages:
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –∑–∞–∫—ñ–Ω—á–∏–≤ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è —ñ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –Ω–∞ –±–∞–∑—É."
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –∑–∞–∫—ñ–Ω—á–∏–≤ –∑ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è–º."
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –≤–∏–∫–æ–Ω–∞–≤ —Å–≤–æ—é –∑–∞–≤–¥–∞–Ω–Ω—è."
          - "–ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –∑–∞–∫—ñ–Ω—á–µ–Ω–æ! –†–æ–±–æ—Ç –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ–¥–æ–º—É."
          - "–†–æ–±–æ—Ç –ø—Ä–∏–±—Ä–∞–≤ –∫–≤–∞—Ä—Ç–∏—Ä—É! –ù–∞–º–∞–≥–∞–π—Ç–µ—Å—å –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–æ—Ä—è–¥–æ–∫!"
          - "–†–æ–±–æ—Ç –≤—Å–µ –ø—Ä–∏–±—Ä–∞–≤! –ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ —á–∏—Å—Ç–æ –Ω–µ —Ç–∞–º, –¥–µ –ø—Ä–∏–±–∏—Ä–∞—é—Ç—å, –∞ —Ç–∞–º –¥–µ –Ω–µ —Å–º—ñ—Ç—è—Ç—å!"
          - "–¢–µ–ø–µ—Ä –≤–¥–æ–º–∞ —á–∏—Å—Ç–æ! –ü–æ–¥—è–∫—É–π—Ç–µ —Ä–æ–±–æ—Ç—É –∑–∞ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è ‚Äî –≤—ñ–Ω —Å—Ç–∞—Ä–∞–≤—Å—è –¥–ª—è –≤–∞—Å."

- id: vacuum_error_notification
  alias: Vacuum Error Notification
  description: Notify when error with vacuum occured
  trigger:
    platform: state
    entity_id: vacuum.roborock
    to: 'error'
  action:
    - service: script.announcement
      data:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        messages:
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –∑—ñ—Ç–∫–Ω—É–≤—Å—è –∑ –ø–æ–º–∏–ª–∫–æ—é: {{ state_attr('vacuum.roborock', 'error') }}"
          - "–ü—Ä–æ–±–ª–µ–º–∞ –∑ –ø–∏–ª–æ—Å–æ—Å–æ–º! {{ state_attr('vacuum.roborock', 'friendly_name') }} –ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –¥–æ–ø–æ–º–æ–≥—É!"
          - "–•–∞–ª–µ–ø–∞! {{ state_attr('vacuum.roborock', 'friendly_name') }} –ø–æ—Ç—Ä–µ–±—É—î –≤–∞—à–æ—ó –¥–æ–ø–æ–º–æ–≥–∏!"
          - "–û–π! –ó —Ä–æ–±–æ—Ç–æ–º —Å—Ç–∞–ª–∞—Å—å –ø—Ä–∏–≥–æ–¥–∞: {{ state_attr('vacuum.roborock', 'error') }}"
          - "–£–≤–∞–≥–∞! –í–∏–Ω–∏–∫–ª–∞ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è –∑ —Ä–æ–±–æ—Ç–æ–º: {{ state_attr('vacuum.roborock', 'error') }}"
    - service: notify.all
      data:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        message: "–û–π! –°—Ç–∞–ª–∞—Å—å –ø–æ–º–∏–ª–∫–∞: {{ state_attr('vacuum.roborock', 'error') }}"

- id: vacuum_ask_maintenance
  alias: Vacuum Ask Maintenance
  description: Send vacuum near trash bin and ask for maintenance
  trigger:
    platform: state
    entity_id: vacuum.roborock
    to: 'returning'
  condition:
    # Every 5th cleaning
    - condition: template
      value_template: >
        {{ state_attr('vacuum.roborock', 'cleaning_count') % 5 == 0 }}
    # And there was at least one cleaning after previous maintenance
    - condition: template
      value_template: >
        {% set last_maintenance = as_timestamp(state_attr('script.vacuum_maintenance', 'last_triggered')) | int %}
        {% set last_cleaning = as_timestamp(state_attr('vacuum.roborock', 'clean_start')) | int %}
        {{ last_cleaning > last_maintenance }}
  action:
    - service: script.announcement
      data:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        messages:
          - "–ü–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—Å–ª—É–∂–∏—Ç–∏ –ø–∏–ª–æ—Å–æ—Å: –ø–æ—á–∏—Å—Ç–∏—Å—Ç–∏ —Ç–∞ –Ω–∞–±–µ—Ä–∞—Ç–∏ —Å–≤—ñ–∂–æ—ó –≤–æ–¥–∏."
          - "–ß–∞—Å –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –ø–∏–ª–æ—Å–æ—Å–∞. –í–∏–∫–∏–Ω—å—Ç–µ —Å–º—ñ—Ç—Ç—è, –Ω–∞–±–µ—Ä—ñ—Ç—å –≤–æ–¥–∏ —ñ –ø–æ—á–∏—Å—Ç—ñ—Ç—å –≥–∞–Ω—á—ñ—Ä–∫—É."
          - "–†–æ–±–æ—Ç —Ç—Ä—É–¥–∏–≤—Å—è –¥–ª—è –≤–∞—Å, –∞ —Ç–µ–ø–µ—Ä –ø–æ—Ç—Ä–µ–±—É—î –≤–∞—à–æ—ó —É–≤–∞–≥–∏. –ü–æ—á–∏—Å—Ç—ñ—Ç—å –π–æ–≥–æ —Ç–∞ –Ω–∞–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–æ—ó –≤–æ–¥–∏ —É –±–∞–∫!"
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –ø–æ—Ç—Ä–µ–±—É—î –ø—ñ–∫–ª—É–≤–∞–Ω–Ω—è –ø—Ä–æ —Å–µ–±–µ. –ù–∞–±–µ—Ä—ñ—Ç—å –≤–æ–¥–∏ —Ç–∞ –ø–æ—á–∏—Å—Ç—ñ—Ç—å –π–æ–≥–æ!"
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è. –í–∫–∏–Ω—å—Ç–µ —Å–º—ñ—Ç—Ç—è —Ç–∞ –Ω–∞–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–æ—ó –≤–æ–¥–∏."
    - service: script.vacuum_maintenance
