- id: vacuum_start_cleaning
  alias: Vacuum Start Cleaning
  description: Regular vacuum cleaning every two days
  trigger:
    - platform: time
      at: '15:00'
    - platform: state
      entity_id: group.family
      from: 'home'
      to: 'not_home'
      for: '00:10:00'
  condition:
    # There was no cleaning in past 24 hours
    - condition: template
      value_template: >
        {% set last_cleaning = as_timestamp(state_attr('vacuum.roborock', 'clean_start')) | int %}
        {% set current_time = as_timestamp(now()) | int %}
        {{ current_time - last_cleaning > (60 * 60 * 24) }}
  action:
    - service: script.announcement
      data_template:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        messages:
          - "–ü–æ—á–∏–Ω–∞—î–º–æ –ø–ª–∞–Ω–æ–≤–µ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –≤–¥–æ–º–∞."
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –ø–æ—á–∏–Ω–∞—î –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è."
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –ø–æ—á–∏–Ω–∞—î –ø—Ä–∏–±–∏—Ä–∞—Ç–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É."
    - service: vacuum.set_fan_speed
      entity_id: vacuum.roborock
      data:
        fan_speed: Turbo
    - delay: '00:00:05'
    - service: vacuum.start
      entity_id: vacuum.roborock

- id: vacuum_finish_cleaning
  alias: Vacuum Stop Cleaning
  description: Send vacuum home when somebody comes home
  trigger:
    platform: state
    entity_id: group.family
    from: not_home
    to: home
  action:
    - service: vacuum.return_to_base
      entity_id: vacuum.roborock

- id: vacuum_finish_notification
  alias: Vacuum Finish Notification
  description: Notify when vacuum finished cleaning
  trigger:
    platform: state
    entity_id: vacuum.roborock
    from: 'cleaning'
    to: 'returning'
  action:
    - service: script.announcement
      data_template:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        messages:
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –∑–∞–∫—ñ–Ω—á–∏–≤ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è —ñ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –Ω–∞ –±–∞–∑—É."
          - "–ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –∑–∞–∫—ñ–Ω—á–µ–Ω–æ! –†–æ–±–æ—Ç –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ–¥–æ–º—É."
          - "–¢–µ–ø–µ—Ä –≤–¥–æ–º–∞ —á–∏—Å—Ç–æ! –ü–æ–¥—è–∫—É–π—Ç–µ —Ä–æ–±–æ—Ç—É –∑–∞ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è ‚Äî –≤—ñ–Ω —Å—Ç–∞—Ä–∞–≤—Å—è –¥–ª—è –≤–∞—Å."

- id: vacuum_error_notification
  alias: Vacuum Error Notification
  description: Notify when error with vacuum occured
  trigger:
    platform: state
    entity_id: vacuum.roborock
    to: 'error'
  action:
    - service: script.announcement
      data_template:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        messages:
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –∑—ñ—Ç–∫–Ω—É–≤—Å—è –∑ –ø–æ–º–∏–ª–∫–æ—é: {{ state_attr('vacuum.roborock', 'error') }}"
          - "–ü—Ä–æ–±–ª–µ–º–∞ –∑ –ø–∏–ª–æ—Å–æ—Å–æ–º! {{ state_attr('vacuum.roborock', 'friendly_name') }} –ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –¥–æ–ø–æ–º–æ–≥—É!"
          - "–•–∞–ª–µ–ø–∞! {{ state_attr('vacuum.roborock', 'friendly_name') }} –ø–æ—Ç—Ä–µ–±—É—î –≤–∞—à–æ—ó –¥–æ–ø–æ–º–æ–≥–∏!"
          - "–û–π! –ó —Ä–æ–±–æ—Ç–æ–º —Å—Ç–∞–ª–∞—Å—å –ø—Ä–∏–≥–æ–¥–∞: {{ state_attr('vacuum.roborock', 'error') }}"
          - "–£–≤–∞–≥–∞! –í–∏–Ω–∏–∫–ª–∞ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è –∑ —Ä–æ–±–æ—Ç–æ–º: {{ state_attr('vacuum.roborock', 'error') }}"
    - service: notify.all
      data_template:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        message: "–û–π! –°—Ç–∞–ª–∞—Å—å –ø–æ–º–∏–ª–∫–∞: {{ state_attr('vacuum.roborock', 'error') }}"

- id: vacuum_ask_maintenance
  alias: Vacuum Maintenance
  description: Send vacuum near trash bin and ask for maintenance
  trigger:
    platform: state
    entity_id: vacuum.roborock
    to: 'docked'
  condition:
    # Every 10th cleaning
    - condition: template
      value_template: >
        {{ state_attr('vacuum.roborock', 'cleaning_count') % 10 == 0 }}
    # And there was at least one cleaning after previous maintenance
    - condition: template
      value_template: >
        {% set last_maintenance = as_timestamp(state_attr('automation.vacuum_maintenance', 'last_triggered')) | int %}
        {% set last_cleaning = as_timestamp(state_attr('vacuum.roborock', 'clean_start')) | int %}
        {{ last_cleaning > last_maintenance }}
  action:
    - service: script.announcement
      data_template:
        title: "–ü–∏–ª–æ—Å–æ—Å üßπ"
        messages:
          - "–ß–∞—Å –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –ø–∏–ª–æ—Å–æ—Å–∞. –í–∏–∫–∏–Ω—å—Ç–µ —Å–º—ñ—Ç—Ç—è, –Ω–∞–±–µ—Ä—ñ—Ç—å –≤–æ–¥–∏ —ñ –ø–æ—á–∏—Å—Ç—ñ—Ç—å –≥–∞–Ω—á—ñ—Ä–∫—É."
          - "–†–æ–±–æ—Ç —Ç—Ä—É–¥–∏–≤—Å—è –¥–ª—è –≤–∞—Å, –∞ —Ç–µ–ø–µ—Ä –ø–æ—Ç—Ä–µ–±—É—î –≤–∞—à–æ—ó —É–≤–∞–≥–∏. –ü–æ—á–∏—Å—Ç—ñ—Ç—å –π–æ–≥–æ —Ç–∞ –Ω–∞–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–æ—ó –≤–æ–¥–∏ —É –±–∞–∫!"
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –ø–æ—Ç—Ä–µ–±—É—î –ø—ñ–∫–ª—É–≤–∞–Ω–Ω—è –ø—Ä–æ —Å–µ–±–µ. –ù–∞–±–µ—Ä—ñ—Ç—å –≤–æ–¥–∏ —Ç–∞ –ø–æ—á–∏—Å—Ç—ñ—Ç—å –π–æ–≥–æ!"
          - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è. –í–∫–∏–Ω—å—Ç–µ —Å–º—ñ—Ç—Ç—è —Ç–∞ –Ω–∞–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–æ—ó –≤–æ–¥–∏."
    - service: vacuum.send_command
      entity_id: vacuum.roborock
      data:
        command: app_goto_target
        params: [24500, 24500] # Coordinates near the trash bin
